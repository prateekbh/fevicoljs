!function(a,b){"use strict";"function"==typeof define&&define.amd?define(["riot"],b):"object"==typeof exports&&"string"!=typeof exports.nodeName?module.exports=b(require("riot")):a.veronica=b(riot)}(this,function(a){"use strict";var b={version:"v0.9.2",settings:{viewTag:".app-body",maxPageTransitionTime:200,enablePageTransitions:!1,listenPopState:!0}},c={flux:{}},d=["UCBrowser","Opera Mini"],e={BROWSER_SUPPORT:"A"};return function(a){function c(){var a=!1,b="animation",c="",d="Webkit Moz O ms Khtml".split(" "),e="",f=$("body")[0];if(void 0!==f.style.animationName&&(a=!0),a===!1)for(var g=0;g<d.length;g++)if(void 0!==f.style[d[g]+"AnimationName"]){e=d[g],b=e+"Animation",c="-"+e.toLowerCase()+"-",a=!0;break}return a}function e(){for(var a=0;d>a;a++){var b=d[a];if(-1!==navigator.userAgent.indexOf(b))return!0}return!1}function f(a){for(var c=a.target,d=0;c&&4>d;){if("A"===c.tagName){a.preventDefault();var e="mounting",f="unmount";c.getAttribute("data-pageentereffect")&&(e=c.getAttribute("data-pageentereffect").trim()),c.getAttribute("data-pageleaveeffect")&&(f=c.getAttribute("data-pageleaveeffect").trim()),b.loc(c.getAttribute("href"),e,f);break}c=c.parentNode,d+=1}}function g(a){var b=document.createEvent("CustomEvent");return b.initEvent(a),b}a.capabilities={testAnimationCapability:c,isBrowserSemiSupported:e,handleClick:f,createEvent:g}}(c),function(a){a.$=function(a,b){return document.querySelectorAll(a,b)}}(window),function(a){var b=function(){var a=this,b={};a.on=function(a,c,d){if(!(arguments.length<2||"string"!=typeof a||"function"!=typeof c)){var e=c.toString();"undefined"!=typeof b[a]?"boolean"==typeof d?b[a].callbacks[e].once=d:b[a].callbacks[e]={cb:c,once:!!d}:(b[a]={callbacks:{}},b[a].callbacks[e]={cb:c,once:!!d})}},a.once=function(b,c){a.on(b,c,!0)},a.off=function(a,c){if("string"==typeof a&&"undefined"!=typeof b[a])if("function"==typeof c){var d=c.toString(),e=b[a].callbacks[d];"undefined"!=typeof e&&delete b[a].callbacks[d]}else delete b[a]},a.trigger=function(c,d){if("string"==typeof c&&"undefined"!=typeof b[c])for(var e in b[c].callbacks){var f=b[c].callbacks[e];"function"==typeof f.cb&&f.cb(d),"boolean"==typeof f.once&&f.once===!0&&a.off(c,f.cb)}}};a.PB=b,a.Dispatcher=new b}(c),function(a){function b(){this._successCallbacks=[],this._errorCallbacks=[]}function c(a,b,c,d){c.push(function(){var c=a.apply(b,arguments);c&&"function"==typeof c.then&&c.then(d.done,d)})}b.prototype.then=function(a,d){var e;return this._isdone?e=a.apply(d,this.result):(e=new b,c(a,d,this._successCallbacks,e)),this},b.prototype["catch"]=function(a,d){var e;return this._isdone&&this._isfailure?e=a.apply(d,this.result):(e=new b,c(a,d,this._errorCallbacks,e)),this},b.prototype.resolve=function(){this.result=arguments,this._isdone=!0,this._issuccess=!0;for(var a=0;a<this._successCallbacks.length;a++)this._successCallbacks[a].apply(null,arguments);this._successCallbacks=[]},b.prototype.reject=function(){this.result=arguments,this._isdone=!0,this._isfailure=!0;for(var a=0;a<this._errorCallbacks.length;a++)this._errorCallbacks[a].apply(null,arguments);this._errorCallbacks=[]};var d={Promise:b};a.promise=d}(c),function(a){function b(a){var b="";if("string"==typeof a)b=a;else{var c=encodeURIComponent;for(var d in a)a.hasOwnProperty(d)&&(b+="&"+c(d)+"="+c(a[d]))}return b}function c(){var a;if(window.XMLHttpRequest)a=new XMLHttpRequest;else if(window.ActiveXObject)try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){a=new ActiveXObject("Microsoft.XMLHTTP")}return a}function d(d,e,f,g){function h(){n.reject(m.ETIMEOUT,"AJAX:TIMEOUT",i),i.abort()}var i,j,n=new a.promise.Promise;f=f||{},g=g||{};for(var o in k)g[o]=k[o];for(var p in l)f[p]=l[p];try{i=c()}catch(q){return n.reject(m.ENOXHR,"AJAX:ABSENT"),n}j=b(f),"GET"===d&&j&&(e+="?"+j,j=null),i.open(d,e),"POST"===d?i.setRequestHeader("Content-type","application/json"):i.setRequestHeader("Content-type","*/*");for(var r in g)g.hasOwnProperty(r)&&i.setRequestHeader(r,g[r]);var s=m.ajaxTimeout;if(s)var t=setTimeout(h,s);return i.onreadystatechange=function(){if(s&&clearTimeout(t),4===i.readyState){var a=!i.status||(i.status<200||i.status>=300)&&304!==i.status;a?n.reject(i.responseText,i):n.resolve(i.responseText,i)}},i.send(j),n}function e(a){return function(b,c,e){return d(a,b,c,e)}}function f(a){k=a}function g(){return k}function h(a){l=a}function i(){return l}function j(a){"number"==typeof a&&(m.ajaxTimeout=a)}var k={},l={},m={ajax:d,get:e("GET"),post:e("POST"),put:e("PUT"),del:e("DELETE"),ENOXHR:1,ETIMEOUT:2,ajaxTimeout:15e3};a.http={},a.http.ajax=m.ajax,a.http.get=m.get,a.http.post=m.post,a.http.put=m.put,a.http["delete"]=m.del,a.httpGlobal={},a.httpGlobal.setAjaxTimeout=j,a.httpGlobal.getGlobalHeaders=g,a.httpGlobal.setGlobalHeaders=f,a.httpGlobal.getGlobalData=i,a.httpGlobal.setGlobalData=h}(c),function(a){function b(a,b){sessionStorage?sessionStorage[a]=b:g[a]=b}function c(a){return sessionStorage[a]||g[a]}function d(a,b){localStorage?localStorage[a]=b:h[a]=b}function e(a){return localStorage[a]||h[a]}function f(a){localStorage?localStorage.removeItem(a):delete h[a]}a.Storage={};var g=[];a.Storage.Session={set:b,get:c};var h=[];a.Storage.DS={set:d,get:e,removeData:f}}(c),function(a){var b=function(a,b){return b.prototype=new a,b};a.extender=b}(c),function(b,c){function d(a,b,c){return{url:b,state:a,component:c}}function f(){return q.currentState.state}function g(){var a=location.pathname.split("#")[0];if("string"==typeof a)return a;if(a.length>0)return a[0];throw new Error("Unable to process route")}function h(a){if(!(a&&a.url&&a.component))throw new Error("Route object should contain a URL regex and a component name");var b=/:([A-Za-z0-9]*)$|:(([A-Za-z0-9]*)\/)/g,c=a.url.match(b),d=a.url;if(c)for(var e=0;e<c.length;e++)c[e]=c[e].replace("/",""),d=d.replace(c[e],"(.*)");a.regex=new RegExp("^"+d+"$","i"),a.paramDictionary=c,q.routes.push(a)}function i(a,b,c){if(!b||0===b.length)return{};var d=c.match(a),e={};d.shift();for(var f=0;f<b.length;f++)e[b[f]]=d[f];return e}function j(){if(0===arguments.length)return q.currentState;if(arguments.length>0&&"string"==typeof arguments[0]){var a=arguments[0],c=g();if(history&&history.pushState){var d=!1;for(var e in q.routes){var f=q.routes[e],h=f.regex;if(h.test(a)&&q.currentState.name!==f.state){f.data=i(h,f.paramDictionary,a);var j={};j.component=f.component,j.data=f.data,j.url=f.url,j.state=f.state,""===q.currentState.name?history.replaceState(j,"",a):(f.prevPage=c,arguments[1]&&"boolean"==typeof arguments[1]&&arguments[1]===!0?history.replaceState(j,"",a):history.pushState(j,"",a)),d=!0,b.Dispatcher.trigger("veronica:stateChange",f);var l="mounting",m="unmount";arguments[1]&&"string"==typeof arguments[1]&&(l=arguments[1]),arguments[2]&&"string"==typeof arguments[2]&&(m=arguments[2]),k(f,l,m);break}}d||(location.href=a)}else a!==c&&(location.href=a)}}function k(b,c,d){if(null!==b){var e=b.component;q.currentState;q.currentState.name=b.state,q.currentState.state=b,q.currentComponent=document.createElement(e),l(c,d);a.mount(e,{})}}function l(a,d){if(a=a||"mounting",d=d||"unmount",q.viewTag)if(q.pageTag.children.length>0){var f=document.createElement("div");if(q.shownEventFired=!1,f.className="page "+q.currentComponent.tagName.toLowerCase(),f.appendChild(q.currentComponent),q.mountingComponent=f,c.settings.enablePageTransitions&&(q.pageTag.addEventListener("webkitTransitionEnd",m),q.pageTag.addEventListener("oTransitionEnd",m),q.pageTag.addEventListener("transitionend",m)),setTimeout(function(){q.shownEventFired||(n(q.pageTag,f),q.currentComponent.dispatchEvent(b.capabilities.createEvent("shown")))},c.settings.maxPageTransitionTime),"A"===e.BROWSER_SUPPORT&&c.settings.enablePageTransitions)f.classList.add(a),q.pageTag.classList.add(d),q.viewTag.appendChild(f);else{var g=q.viewTag.children&&q.viewTag.children[0],h=g&&g.children&&g.children[0];h._tag&&h._tag.isMounted&&h._tag.unmount();var i=q.currentComponent.tagName.toLowerCase(),j="<div class='page "+i+"'><"+i+"></"+i+"></div>";q.viewTag.innerHTML=j}}else q.pageTag.classList.add(q.currentComponent.tagName.toLowerCase()),q.pageTag.appendChild(q.currentComponent),b.Dispatcher.trigger("veronica:stateTransitionComplete",q.currentState.state)}function m(a){this.removeEventListener("transitionend",m),this.removeEventListener("webkitTransitionEnd",m),this.removeEventListener("oTransitionEnd",m),n(this,q.mountingComponent),q.shownEventFired=!0,q.currentComponent.dispatchEvent(b.capabilities.createEvent("shown"))}function n(a,c){a.className="hidden",p(c),c.className="page "+q.currentComponent.tagName.toLowerCase(),q.pageTag=c,b.Dispatcher.trigger("veronica:stateTransitionComplete",q.currentState.state)}function o(){return history.state?history.state.prevPage||null:null}function p(a){for(var b=q.viewTag.childNodes,c=0;b.length>1;){var d=b[c];d.childNodes[0];d!==a?d.remove?d.remove():d.parentElement&&d.parentElement.removeChild(d):c+=1}}var q={shownEventFired:!1,mountingComponent:null};q.viewTag=$(c.settings.viewTag)[0],q.viewTag?(q.viewTag.innerHTML="<div class='page'></div>",q.pageTag=q.viewTag.querySelector(".page")):q.pageTag=null,q.routes=[],q.currentState={name:"",state:{}},q.currentComponent=null,window.addEventListener("popstate",function(a){c.settings.listenPopState&&a&&a.state&&(q.currentState.state.state!==a.state.state&&b.Dispatcher.trigger("veronica:stateChange",a.state),k(a.state,"mounting-pop","unmount-pop"))}),c.createRoute=d,c.getCurrentPath=g,c.getCurrentState=f,c.getPrevPageUrl=o,c.addRoute=h,c.loc=j,b.totalRouteLength=function(){return q.routes.length}}(c,b),function(a,b,d,e){function f(){this.Dispatcher={trigger:d.trigger},this.Ajax=b,this.Promise=e}var g={};c.flux.Actions={},c.flux.Actions.createAction=function(a,b){try{return g[a]=c.extender(f,b),!0}catch(d){return!1}},c.flux.Actions.getAction=function(a){var b=g[a];return b?new b:null}}(b,c.http,c.Dispatcher,c.promise),function(a,b,d){function e(){var a=new d;this.Dispatcher={register:b.on,unregister:b.off,once:b.once},this.Storage=c.Storage,this.subscribe=a.on,this.unsubscribe=a.off,this.emit=function(b){a.trigger(b,{})}}var f={};c.flux.Stores={},c.flux.Stores.createStore=function(a,b){try{var d=c.extender(e,b);return f[a]=new d,!0}catch(g){return!1}},c.flux.Stores.getStore=function(a){return f[a]}}(b,c.Dispatcher,c.PB),function(b,c){function d(){b.capabilities.testAnimationCapability()||$("body")[0].classList.add("noanim"),b.capabilities.isBrowserSemiSupported()&&(e.BROWSER_SUPPORT="B",$("body")[0].classList.add("noanim")),a.mount("*",{}),b.totalRouteLength()>0&&(c.loc(location.pathname),b.Dispatcher.trigger("veronica:init")),document.addEventListener("click",b.capabilities.handleClick)}document.onreadystatechange=function(){"interactive"==document.readyState&&d()}}(c,b),b.flux=c.flux,b.http=c.httpGlobal,b});